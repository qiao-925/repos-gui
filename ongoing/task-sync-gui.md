# 同步与 GUI 方案任务（进行中）

## 1. 背景与目标
- 目标：为个人账户的 GitHub 公共仓库提供“一键同步 + 批量克隆 + 完整性检查”的 GUI 工具。
- 当前状态：GUI 已覆盖同步/克隆/检查；命令行入口已移除，默认以可执行文件运行。

## 2. 需求范围
### 2.1 必做（MVP）
- 同步流程：读取 `REPO-GROUPS.md` → 拉取公共仓库 → 仅新增写入“未分类”。
- 克隆流程：解析分组 → 并行克隆 → 自动完整性检查（增量更新）。
- 仅检查流程：直接并行检查本地仓库完整性。
- 行为规则：不处理删除/改名/转移；不接触私有仓库；不修改现有分类结构。
- 输出结果：新增数量与列表、克隆/检查统计、失败列表文件。

### 2.2 可选（后续）
- `dry-run` 仅预览差异（GUI 开关）。
- 结构化报告（JSON）用于更细致的 UI 展示。
- 支持私有仓库（需要 Token）。

### 2.3 需求细化（业务规则）
- 账号来源：只读取 `REPO-GROUPS.md` 中的“仓库所有者”。
- 数据范围：仅公共仓库；不触及私有仓库与组织仓库。
- 新增处理：写入“未分类”分组；不存在则自动创建。
- 幂等性：重复执行不产生重复条目。
- 冷处理：删除/改名/转移均不处理。

### 2.4 输入 / 输出
- 输入：`REPO-GROUPS.md`（GUI 可选择文件）。
- 输出：更新后的 `REPO-GROUPS.md` + 失败列表 `failed-repos.txt`。
- 不影响：现有分组结构与本地克隆目录。

### 2.5 边界与异常
- API 限频：无 Token 情况下 60 次/小时，超限需提示。
- 网络异常：超时/不可达需明确错误信息。
- 文件异常：缺少“仓库所有者”时直接失败。
- 编码保持：尽量保留原文件编码与换行风格。

## 3. 非目标
- 私有仓库同步。
- 远端删除与重命名处理。
- 多维分类与自动重排。

## 4. 用户场景
- 个人仓库数量较多，分类文件长期维护，期望“新增仓库自动补齐到未分类”。
- 需要 GUI 完整替代命令行，降低认知负荷，尽量零学习成本。

## 5. 技术栈（候选与取舍）
- GUI 目标：本地可用、低成本、无部署负担。
- 已选方案：PyQt5 桌面 GUI（单页）。
- 复用策略：GUI 复用既有核心逻辑模块，避免规则重复。

## 6. 交互流程与页面结构（GUI 草案）
### 6.1 交互流程（单页）
1. 选择/检测 `REPO-GROUPS.md`
2. 同步预览（可选）
3. 写入未分类（可选）
4. 开始克隆 / 仅检查
5. 完成提示与结果摘要

### 6.2 页面结构
- 单页：文件选择 + 参数设置 + 操作按钮 + 列表 + 日志

### 6.3 失败提示
- 网络失败 / API 限频 / 文件格式错误
- 统一提示“原因 + 建议动作”

## 7. 里程碑与执行计划（草案）
- M0：同步能力完成
- M1：GUI MVP（预览 + 写入未分类）
- M2：GUI 完整覆盖克隆 + 检查
- M3：体验优化（dry-run、报告、错误提示完善）
- 验收标准：
  - 新增仓库被正确写入“未分类”
  - 重复执行不产生重复
  - GUI 预览与写入一致

## 8. 任务清单（已完成）
- [x] 同步能力实现（公共仓库新增写入“未分类”）
- [x] 需求与技术栈定稿（PyQt5 桌面 GUI）
- [x] GUI 单页交互方案
- [x] GUI MVP：同步预览 + 写入未分类
- [x] GUI 覆盖克隆 + 检查
- [x] GUI 日志回调（非终端输出）
- [x] CLI 入口移除
- [x] README 简化为“仅可执行文件运行”

## 9. 关键决策（已确认）
1. ✅ GUI 首选形态：PyQt5 桌面 GUI（本地运行，无需服务器）
2. ✅ 单页结构：保持简单与低认知负荷
3. ✅ GUI 为唯一入口：移除 CLI 入口
4. ⏸️ 是否需要登录（Token）：暂不支持，使用公开 API（60次/小时）

## 10. 已实现功能
- ✅ PyQt5 单页 GUI（gui.py）
- ✅ 同步预览（preview_sync）：获取新增仓库列表但不写入
- ✅ 应用同步（apply_sync）：将新增仓库写入“未分类”
- ✅ 批量克隆（增量更新 + 并行）
- ✅ 完整性检查（git fsck）
- ✅ 失败列表输出（failed-repos.txt）
- ✅ 异步处理：QThread 避免界面卡顿
- ✅ GUI 日志回调：脱离终端输出
- ✅ 文件选择：支持选择自定义 REPO-GROUPS.md 文件
- ✅ 文档更新：README 简化为可执行版运行

## 11. 后续优化方向（可选）
- [ ] 支持 GitHub Token 认证（提高 API 频率限制）
- [ ] 支持 dry-run 模式
- [ ] 结构化报告（JSON）
- [ ] 支持私有仓库同步

## 12. 计划推进方式
- 先讨论需求与技术栈 → 补全本文件 → 再执行实施。
