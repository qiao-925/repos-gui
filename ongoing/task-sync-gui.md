# 同步与 GUI 方案任务（进行中）

## 1. 背景与目标
- 目标：为个人账户的 GitHub 公共仓库提供“一键同步”能力，并在后续提供 GUI 提升可用性。
- 当前状态：已具备 `repos sync`（新增公共仓库写入“未分类”）能力；尚无 GUI。

## 2. 需求范围
### 2.1 必做（MVP）
- 同步流程：读取 `REPO-GROUPS.md` → 拉取公共仓库 → 仅新增写入“未分类”。
- 行为规则：不处理删除/改名/转移；不接触私有仓库；不修改现有分类结构。
- 输出结果：新增数量与列表。

### 2.2 可选（后续）
- `--dry-run` 仅预览差异。
- 同步后自动触发克隆。
- 结构化报告（JSON）用于 GUI。

### 2.3 需求细化（业务规则）
- 账号来源：只读取 `REPO-GROUPS.md` 中的“仓库所有者”。
- 数据范围：仅公共仓库；不触及私有仓库与组织仓库。
- 新增处理：写入“未分类”分组；不存在则自动创建。
- 幂等性：重复执行不产生重复条目。
- 冷处理：删除/改名/转移均不处理。

### 2.4 输入 / 输出
- 输入：`REPO-GROUPS.md`（可通过 `-f` 指定文件）。
- 输出：更新后的 `REPO-GROUPS.md` + 控制台报告（新增数量与列表）。
- 不影响：现有分组结构与本地克隆目录。

### 2.5 边界与异常
- API 限频：无 Token 情况下 60 次/小时，超限需提示。
- 网络异常：超时/不可达需明确错误信息。
- 文件异常：缺少“仓库所有者”时直接失败。
- 编码保持：尽量保留原文件编码与换行风格。

## 3. 非目标
- 私有仓库同步。
- 远端删除与重命名处理。
- 多维分类与自动重排。

## 4. 用户场景
- 个人仓库数量较多，分类文件长期维护，期望“新增仓库自动补齐到未分类”。
- 需要可视化预览与手动确认，减少误改与学习成本。

## 5. 技术栈（候选与取舍）
- 现状：Python CLI 已有同步能力。
- GUI 目标：本地可用、低成本、无部署负担。
- 方案 A：本地 Web（FastAPI/Flask + 轻前端）
  - 优点：跨平台、易扩展、可做预览与可视化
  - 缺点：需要本地启动服务
- 方案 B：TUI（Text UI）
  - 优点：实现快、依赖少
  - 缺点：交互表达有限，不适合复杂预览
- 方案 C：桌面壳（Electron / Tauri）
  - 优点：体验最好
  - 缺点：成本高、打包复杂
- 暂定建议：先走方案 A（本地 Web），后续再评估桌面壳。
- 复用策略：GUI 复用 CLI 的核心逻辑模块，避免规则重复。

## 6. 交互流程与页面结构（GUI 草案）
### 6.1 交互流程
1. 选择/检测 `REPO-GROUPS.md`
2. 点击“同步预览”
3. 展示新增列表与统计
4. 点击“写入未分类”并确认
5. 完成提示与结果摘要

### 6.2 页面结构
- 同步页：文件路径、owner 展示、同步按钮
- 预览页：新增仓库列表、数量、确认按钮
- 结果页：成功/失败提示、变更统计
- 设置页（可选）：超时、分页、请求频率

### 6.3 失败提示
- 网络失败 / API 限频 / 文件格式错误
- 统一提示“原因 + 建议动作”

## 7. 里程碑与执行计划（草案）
- M0：同步 CLI 已完成（当前）
- M1：需求与方案确认（补全文档、冻结规则）
- M2：GUI MVP（预览 + 写入未分类）
- M3：体验优化（dry-run、报告、错误提示完善）
- 验收标准：
  - 新增仓库被正确写入“未分类”
  - 重复执行不产生重复
  - GUI 预览与写入一致

## 8. 任务清单（已完成 MVP）
- [x] `repos sync` 实现（公共仓库新增写入"未分类"）
- [x] 需求与技术栈定稿（选择 PyQt5 桌面 GUI）
- [x] GUI 方案选型与交互流程设计
- [x] GUI MVP：同步预览 + 选择应用 + 写回
- [x] 文档补充与使用说明

## 9. 关键决策（已确认）
1. ✅ GUI 首选形态：PyQt5 桌面 GUI（本地运行，无需服务器）
2. ⏸️ 是否需要登录（Token）：暂不支持，使用公开 API（60次/小时）
3. ⏸️ GUI 是否要支持"同步后立刻克隆"：暂不支持，用户可手动执行 `repos clone`

## 10. 已实现功能
- ✅ PyQt5 GUI 界面（gui.py）
- ✅ 同步预览功能（preview_sync）：获取新增仓库列表但不写入
- ✅ 应用同步功能（apply_sync）：将新增仓库写入"未分类"
- ✅ 异步处理：使用 QThread 避免界面卡顿
- ✅ 实时日志：显示操作日志
- ✅ 错误提示：清晰的错误信息
- ✅ 文件选择：支持选择自定义 REPO-GROUPS.md 文件
- ✅ 文档更新：README 添加 GUI 使用说明

## 11. 后续优化方向（可选）
- [ ] 支持 GitHub Token 认证（提高 API 频率限制）
- [ ] 同步后自动触发克隆
- [ ] 支持 dry-run 模式
- [ ] 结构化报告（JSON）
- [ ] 支持私有仓库同步

## 10. 计划推进方式
- 先讨论需求与技术栈 → 补全本文件 → 再执行实施。

